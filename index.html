<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>ì‹íƒë³´ AI</title>
    <base href="/" />

    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="description" content="AI ì±—ë´‡ê³¼ Windows Sandbox ì„¤ì •ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ëŠ” PWA ì•±" />
    <meta name="keywords" content="ì‹íƒë³´, AI, ì±—ë´‡, Windows Sandbox, PWA, ì˜¤í”ˆë¼ìš°í„°" />
    <meta name="author" content="ì‹íƒë³´ íŒ€" />
    <meta name="theme-color" content="#03173d" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#03173d" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="ì‹íƒë³´ AI" />
    <meta name="application-name" content="ì‹íƒë³´ AI" />
    <meta name="msapplication-TileColor" content="#03173d" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="format-detection" content="telephone=no" />

    <!-- iOS ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦° (ì„ íƒì ) -->
    <link rel="apple-touch-startup-image" href="icon-512.png" />

    <!-- Open Graph ë©”íƒ€ íƒœê·¸ -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ì‹íƒë³´ AI" />
    <meta property="og:description" content="AI ì±—ë´‡ê³¼ Windows Sandbox ì„¤ì •ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ëŠ” PWA ì•±" />
    <meta property="og:url" content="https://yourtablecloth.app/" />
    <meta property="og:image" content="https://yourtablecloth.app/icon-512.png" />
    <meta property="og:site_name" content="ì‹íƒë³´ AI" />

    <!-- Twitter Card ë©”íƒ€ íƒœê·¸ -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ì‹íƒë³´ AI" />
    <meta name="twitter:description" content="AI ì±—ë´‡ê³¼ Windows Sandbox ì„¤ì •ì„ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ëŠ” PWA ì•±" />
    <meta name="twitter:image" content="https://yourtablecloth.app/icon-512.png" />

    <!-- í…Œë§ˆ ì´ˆê¸° ë¡œë”© ìŠ¤í¬ë¦½íŠ¸ (FOUC ë°©ì§€) -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme-preference') || 'Auto';
            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;

            // ì‹œìŠ¤í…œ í…Œë§ˆ ìƒì„¸ ì •ë³´
            const systemThemeInfo = {
                mediaQuerySupported: !!window.matchMedia,
                prefersDark: prefersDark,
                prefersLight: prefersLight,
                noPreference: !prefersDark && !prefersLight,
                userAgent: navigator.userAgent,
                platform: getPlatform(),
                currentTime: new Date().toLocaleString()
            };

            let shouldApplyDark = false;
            let reason = '';

            if (savedTheme === 'Dark') {
                shouldApplyDark = true;
                reason = 'ì‚¬ìš©ìê°€ ë‹¤í¬ ëª¨ë“œë¥¼ ì„ íƒí•¨';
            } else if (savedTheme === 'Light') {
                shouldApplyDark = false;
                reason = 'ì‚¬ìš©ìê°€ ë¼ì´íŠ¸ ëª¨ë“œë¥¼ ì„ íƒí•¨';
            } else if (savedTheme === 'Auto') {
                shouldApplyDark = prefersDark;
                reason = prefersDark ?
                    'ìë™ ëª¨ë“œ: ì‹œìŠ¤í…œì—ì„œ ë‹¤í¬ ëª¨ë“œë¥¼ ì„ í˜¸í•¨' :
                    'ìë™ ëª¨ë“œ: ì‹œìŠ¤í…œì—ì„œ ë¼ì´íŠ¸ ëª¨ë“œë¥¼ ì„ í˜¸í•¨ (ë˜ëŠ” ì„ í˜¸ë„ ì—†ìŒ)';
            }

            console.log('ğŸ¨ í…Œë§ˆ ì´ˆê¸° ë¡œë”© ìƒì„¸ ì •ë³´:', {
                savedTheme,
                shouldApplyDark,
                reason,
                systemInfo: systemThemeInfo
            });

            // í”Œë«í¼ ê°ì§€ í•¨ìˆ˜
            function getPlatform() {
                const ua = navigator.userAgent;
                if (ua.includes('Windows')) return 'Windows';
                if (ua.includes('Mac')) return 'macOS';
                if (ua.includes('iPhone') || ua.includes('iPad')) return 'iOS';
                if (ua.includes('Android')) return 'Android';
                if (ua.includes('Linux')) return 'Linux';
                return 'Unknown';
            }

            if (shouldApplyDark) {
                document.documentElement.classList.add('dark-theme');
                document.documentElement.classList.remove('light-theme');
                console.log('âœ… ë‹¤í¬ í…Œë§ˆ í´ë˜ìŠ¤ ì ìš©');
            } else {
                document.documentElement.classList.add('light-theme');
                document.documentElement.classList.remove('dark-theme');
                console.log('âœ… ë¼ì´íŠ¸ í…Œë§ˆ í´ë˜ìŠ¤ ì ìš©');
            }

            // ì ìš©ëœ í´ë˜ìŠ¤ì™€ CSS ë³€ìˆ˜ í™•ì¸
            setTimeout(() => {
                console.log('ğŸ“‹ HTML í´ë˜ìŠ¤ ëª©ë¡:', document.documentElement.className);
                const computedStyle = getComputedStyle(document.documentElement);
                console.log('ğŸ¨ ì ìš©ëœ CSS ë³€ìˆ˜ë“¤:', {
                    '--primary-bg': computedStyle.getPropertyValue('--primary-bg').trim(),
                    '--primary-text': computedStyle.getPropertyValue('--primary-text').trim(),
                    '--accent-color': computedStyle.getPropertyValue('--accent-color').trim()
                });

                // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€ ì„¤ì •
                if (window.matchMedia) {
                    const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                    darkModeMediaQuery.addEventListener('change', (e) => {
                        console.log('ğŸ”„ ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€:', e.matches ? 'ë‹¤í¬ ëª¨ë“œ' : 'ë¼ì´íŠ¸ ëª¨ë“œ');
                        if (localStorage.getItem('theme-preference') === 'Auto') {
                            console.log('âš¡ ìë™ ëª¨ë“œì´ë¯€ë¡œ í…Œë§ˆ ìë™ ë³€ê²½');
                        }
                    });
                }
            }, 100);
        })();
    </script>

    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />

    <!-- PWA ë§¤ë‹ˆí˜ìŠ¤íŠ¸ -->
    <link href="manifest.webmanifest" rel="manifest" />

    <!-- Apple í„°ì¹˜ ì•„ì´ì½˜ -->
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />

    <!-- Favicon ë‹¤ì–‘í•œ í¬ê¸° -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png" />

    <!-- TODO: MSBuildë¡œ ì´ì „ ê²€í†  -->
    <link href="https://yourtablecloth.app/TableClothCatalog/Catalog.xml" rel="prefetch" />
    <link href="TableClothLite.styles.css" rel="stylesheet" />

    <!-- HTMLë§Œ ìºì‹œ ë°©ì§€ - ë¦¬ì†ŒìŠ¤ëŠ” ì¡°ê±´ë¶€ ìºì‹œ í—ˆìš© -->
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />

    <link href="_framework/dotnet.hgrpccefmh.js" rel="preload" as="script" fetchpriority="high" crossorigin="anonymous" integrity="sha256-v8zn4E6dy6axL8hKxv0+oW4FZQAQsPrKnYuzcj1knNk=" />
    <script type="importmap">{
  "imports": {
    "./_framework/blazor.webassembly.js": "./_framework/blazor.webassembly.0o6sltz4v8.js",
    "./_framework/dotnet.js": "./_framework/dotnet.hgrpccefmh.js",
    "./_framework/dotnet.native.js": "./_framework/dotnet.native.ki06310okv.js",
    "./_framework/dotnet.runtime.js": "./_framework/dotnet.runtime.580eknzmmv.js"
  },
  "scopes": {},
  "integrity": {
    "./_framework/blazor.webassembly.0o6sltz4v8.js": "sha256-QPblb0B3n+m0u11HG4nhpAiOn39aNT2Jm/OQ+6wpU4s=",
    "./_framework/blazor.webassembly.js": "sha256-QPblb0B3n+m0u11HG4nhpAiOn39aNT2Jm/OQ+6wpU4s=",
    "./_framework/dotnet.hgrpccefmh.js": "sha256-v8zn4E6dy6axL8hKxv0+oW4FZQAQsPrKnYuzcj1knNk=",
    "./_framework/dotnet.js": "sha256-v8zn4E6dy6axL8hKxv0+oW4FZQAQsPrKnYuzcj1knNk=",
    "./_framework/dotnet.native.js": "sha256-5DC+ewufH06dHFvNe2ShXJ4rJ2xXTbIwIok5p1WtB8o=",
    "./_framework/dotnet.native.ki06310okv.js": "sha256-5DC+ewufH06dHFvNe2ShXJ4rJ2xXTbIwIok5p1WtB8o=",
    "./_framework/dotnet.runtime.580eknzmmv.js": "sha256-pfhJg2MOkVUy58SVr89By9FVqxss2F2M68vNi5p7Yc0=",
    "./_framework/dotnet.runtime.js": "sha256-pfhJg2MOkVUy58SVr89By9FVqxss2F2M68vNi5p7Yc0="
  }
}</script>
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <!-- Start Single Page Apps for GitHub Pages -->
    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // https://github.com/rafrex/spa-github-pages
      // Copyright (c) 2016 Rafael Pedicini, licensed under the MIT License
      // ----------------------------------------------------------------------
      // This script checks to see if a redirect is present in the query string
      // and converts it back into the correct url and adds it to the
      // browser's history using window.history.replaceState(...),
      // which won't cause the browser to attempt to load the new url.
      // When the single page app is loaded further down in this file,
      // the correct url will be waiting in the browser's history for
      // the single page app to route accordingly.
      (function(l) {
        if (l.search) {
          var q = {};
          l.search.slice(1).split('&').forEach(function(v) {
            var a = v.split('=');
            q[a[0]] = a.slice(1).join('=').replace(/~and~/g, '&');
          });
          if (q.p !== undefined) {
            window.history.replaceState(null, null,
              l.pathname.slice(0, -1) + (q.p || '') +
              (q.q ? ('?' + q.q) : '') +
              l.hash
            );
          }
        }
      }(window.location))
    </script>

    <div id="blazor-error-ui">
        ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
        <a href="." class="reload">ìƒˆë¡œ ê³ ì¹¨</a>
        <span class="dismiss">&#x1F5D9;</span>
    </div>

    <!-- app.jsë¥¼ ë¨¼ì € ë¡œë“œ -->
    <script src="js/app.js" type="text/javascript"></script>

    <!-- ìŠ¤ë§ˆíŠ¸ ìºì‹œ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // ìŠ¤ë§ˆíŠ¸ ìºì‹œ ë¬´íš¨í™” - ë³€ê²½ëœ ë¦¬ì†ŒìŠ¤ë§Œ ê°±ì‹ 
        (function() {
            const buildVersion = '2024.1.0'; // GitHub Actionsì—ì„œ ìë™ ì—…ë°ì´íŠ¸
            
            // ë¦¬ì†ŒìŠ¤ í•´ì‹œ ì²´í¬ë¥¼ ìœ„í•œ í•¨ìˆ˜
            async function getResourceHash(url) {
                try {
                    const response = await fetch(url, { method: 'HEAD' });
                    return response.headers.get('etag') || response.headers.get('last-modified') || '';
                } catch {
                    return '';
                }
            }
            
            // ìºì‹œëœ ë¦¬ì†ŒìŠ¤ í•´ì‹œ ì €ì¥/ì¡°íšŒ
            function getCachedHash(url) {
                return localStorage.getItem(`hash_${url}`) || '';
            }
            
            function setCachedHash(url, hash) {
                localStorage.setItem(`hash_${url}`, hash);
            }
            
            // ì¡°ê±´ë¶€ ìºì‹œ ë²„ìŠ¤í„° - ë³€ê²½ëœ ë¦¬ì†ŒìŠ¤ë§Œ
            async function addSmartCacheBuster(element, attribute) {
                const originalUrl = element.getAttribute(attribute);
                if (!originalUrl || originalUrl.startsWith('http') || originalUrl.includes('?')) {
                    return;
                }
                
                const currentHash = await getResourceHash(originalUrl);
                const cachedHash = getCachedHash(originalUrl);
                
                // í•´ì‹œê°€ ë‹¤ë¥´ê±°ë‚˜ ì²˜ìŒ ë¡œë“œì‹œì—ë§Œ ë²„ì „ íŒŒë¼ë¯¸í„° ì¶”ê°€
                if (!cachedHash || currentHash !== cachedHash) {
                    const separator = originalUrl.includes('?') ? '&' : '?';
                    element.setAttribute(attribute, originalUrl + separator + 'v=' + buildVersion);
                    
                    if (currentHash) {
                        setCachedHash(originalUrl, currentHash);
                    }
                    
                    console.log(`ìºì‹œ ê°±ì‹ : ${originalUrl}`);
                } else {
                    console.log(`ìºì‹œ ìœ ì§€: ${originalUrl}`);
                }
            }
            
            // DOM ë¡œë“œ í›„ ìŠ¤ë§ˆíŠ¸ ìºì‹œ ì ìš©
            document.addEventListener('DOMContentLoaded', async function() {
                const promises = [];
                
                // CSS íŒŒì¼ë“¤ ì²´í¬
                document.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
                    if (!link.href.startsWith('http')) {
                        promises.push(addSmartCacheBuster(link, 'href'));
                    }
                });
                
                // JavaScript íŒŒì¼ë“¤ ì²´í¬
                document.querySelectorAll('script[src]').forEach(script => {
                    if (!script.src.startsWith('http') && !script.src.includes('_framework/blazor.webassembly.js')) {
                        promises.push(addSmartCacheBuster(script, 'src'));
                    }
                });
                
                await Promise.all(promises);
            });
            
            // ë²„ì „ ì²´í¬ - ì•± ì „ì²´ ë²„ì „ë§Œ í™•ì¸
            let lastVersionCheck = Date.now();
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && Date.now() - lastVersionCheck > 600000) { // 10ë¶„ë§ˆë‹¤ ì²´í¬ë¡œ ë¹ˆë„ ì¤„ì„
                    lastVersionCheck = Date.now();
                    checkForUpdates();
                }
            });
            
            // ì•± ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸
            async function checkForUpdates() {
                try {
                    const response = await fetch('/version.json?t=' + new Date().getTime(), { 
                        cache: 'no-cache'
                    });
                    
                    if (response.ok) {
                        const serverInfo = await response.json();
                        const localVersion = localStorage.getItem('app-version');
                        
                        if (localVersion && serverInfo.version && localVersion !== serverInfo.version) {
                            // Blazor ì»´í¬ë„ŒíŠ¸ì˜ OnNewVersionDetected í˜¸ì¶œ (í¬ì»¤ìŠ¤ ë¹¼ì•—ê¹€ ì—†ìŒ)
                            if (window.DotNet && window.dotNetHelper) {
                                window.dotNetHelper.invokeMethodAsync('OnNewVersionDetected', JSON.stringify(serverInfo));
                            } else {
                                // Blazorê°€ ë¡œë“œë˜ì§€ ì•Šì€ ê²½ìš°ë§Œ ì¡°ìš©í•œ ì½˜ì†” ë¡œê·¸
                                console.log('ìƒˆ ë²„ì „ ê°ì§€ë¨:', serverInfo.version);
                            }
                        }
                        
                        if (serverInfo.version) {
                            localStorage.setItem('app-version', serverInfo.version);
                        }
                    }
                } catch (error) {
                    console.log('Version check failed:', error);
                }
            }
            
            // confirm ì œê±° - Blazor ì»´í¬ë„ŒíŠ¸ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½
            function showUpdateNotification(newVersion) {
                // ë” ì´ìƒ confirm ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
                console.log('ì—…ë°ì´íŠ¸ ì•Œë¦¼ì„ Blazor ì»´í¬ë„ŒíŠ¸ë¡œ ì „ë‹¬:', newVersion);
            }
            
            // ìŠ¤ë§ˆíŠ¸ ìƒˆë¡œê³ ì¹¨ - ì„ íƒì  ìºì‹œ í´ë¦¬ì–´
            function smartRefresh() {
                // Service Worker ì—…ë°ì´íŠ¸
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.getRegistrations().then(function(registrations) {
                        for(let registration of registrations) {
                            registration.update();
                        }
                    });
                }
                
                // ì•± ë²„ì „ë§Œ í´ë¦¬ì–´ (ë¦¬ì†ŒìŠ¤ í•´ì‹œëŠ” ìœ ì§€)
                localStorage.removeItem('app-version');
                
                // ë¶€ë“œëŸ¬ìš´ ìƒˆë¡œê³ ì¹¨
                window.location.reload();
            }
            
            // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
            window.forceRefresh = smartRefresh;
            window.checkForUpdates = checkForUpdates;
        })();
    </script>

    <script src="_framework/blazor.webassembly.0o6sltz4v8.js"></script>
    <script>
        // Service Worker ë“±ë¡ - í¬ì»¤ìŠ¤ ë¹¼ì•—ê¹€ ì—†ëŠ” ì—…ë°ì´íŠ¸ ì²˜ë¦¬
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(function(registration) {
                    console.log('ServiceWorker registration successful');
                    
                    // ì—…ë°ì´íŠ¸ ê°ì§€
                    registration.addEventListener('updatefound', function() {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', function() {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¡°ìš©íˆ ì—…ë°ì´íŠ¸ - confirm ì œê±°
                                console.log('ìƒˆ Service Workerê°€ ì„¤ì¹˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                                
                                // Blazor ì»´í¬ë„ŒíŠ¸ë¡œ ì•Œë¦¼ ì „ë‹¬ (í¬ì»¤ìŠ¤ ë¹¼ì•—ê¹€ ì—†ìŒ)
                                if (window.DotNet && window.dotNetHelper) {
                                    const updateInfo = {
                                        type: 'serviceWorker',
                                        message: 'ì•±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.'
                                    };
                                    
                                    // 5ì´ˆ í›„ ë¶€ë“œëŸ¬ìš´ ì•Œë¦¼
                                    setTimeout(() => {
                                        window.dotNetHelper.invokeMethodAsync('OnNewVersionDetected', JSON.stringify(updateInfo));
                                    }, 5000);
                                } else {
                                    // Blazorê°€ ì¤€ë¹„ë˜ì§€ ì•Šì€ ê²½ìš° ì¡°ìš©íˆ ë¡œê·¸ë§Œ
                                    console.log('Service Worker ì—…ë°ì´íŠ¸ ì™„ë£Œ - Blazor ë¡œë“œ ëŒ€ê¸° ì¤‘');
                                }
                            }
                        });
                    });
                    
                    // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ ì²´í¬ (30ë¶„ë§ˆë‹¤)
                    setInterval(() => {
                        registration.update();
                    }, 30 * 60 * 1000);
                })
                .catch(function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
        }
    </script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HBJP4P0EBY"></script>
    <script type="text/javascript">
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-HBJP4P0EBY');
    </script>
</body>

</html>